<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8" />
    <title>Полиці LAIT (Lite) — MT × Systems</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Спільні стилі МТ hub -->
    <link rel="stylesheet" href="mtu-hub.css" />

    <style>
        /* ========================
           1. LAIT Lite — базовий (світлий) стиль
           ========================= */

        .lait-root {
            margin-top: 24px;
            border-radius: 26px;
            padding: 22px 22px 26px;
            background: #ffffff; /* світла карта */
            border: 1px solid rgba(15, 23, 42, 0.06);
            box-shadow: 0 28px 80px rgba(15, 23, 42, 0.10);
            color: #0f172a;
        }

        .lait-root-title {
            font-size: 18px;
            font-weight: 600;
            margin: 0 0 12px;
            color: #0f172a;
        }

        .lait-calc-grid {
            display: grid;
            gap: 18px;
        }

        .lait-panel {
            border-radius: 20px;
            background: #f9fafb;
            border: 1px solid rgba(15, 23, 42, 0.06);
            box-shadow: 0 16px 40px rgba(15, 23, 42, 0.06);
            padding: 18px 20px;
            color: #0f172a;
        }

        .lait-panel--inputs {
            grid-column: 1 / -1;
        }

        .lait-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px 16px;
            margin-bottom: 14px;
        }

        .lait-grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 12px 16px;
        }

        .lait-intro {
            font-size: 13px;
            color: #6b7280;
            margin-bottom: 10px;
        }

        .lait-bullets {
            margin: 0;
            padding-left: 18px;
            font-size: 13px;
            color: #4b5563;
        }

        .lait-bullets li + li {
            margin-top: 4px;
        }

        /* ====== поля форми ====== */

        .field {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .field label {
            font-size: 12px;
            color: #475569;
        }

        .field small {
            font-size: 11px;
            color: #9ca3af;
        }

        .field input,
        .field select {
            background: #ffffff;
            border-radius: 10px;
            border: 1px solid rgba(148, 163, 184, 0.55);
            padding: 7px 10px;
            font-size: 13px;
            color: #0f172a;
            outline: none;
            transition: border-color 0.15s ease, box-shadow 0.15s ease;
        }

        .field input::placeholder {
            color: #9ca3af;
        }

        .field input:focus,
        .field select:focus {
            border-color: #4f46e5;
            box-shadow: 0 0 0 1px rgba(79, 70, 229, 0.4);
        }

        /* ====== кнопка "Розрахувати" ====== */

        .button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 8px 20px;
            border-radius: 999px;
            border: none;
            background: #22c55e;
            color: #052e16;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 12px 30px rgba(34, 197, 94, 0.35);
            transition: transform 0.1s ease, box-shadow 0.1s ease, opacity 0.1s ease;
        }

        .button:hover {
            transform: translateY(-1px);
            box-shadow: 0 16px 40px rgba(34, 197, 94, 0.55);
        }

        .button:active {
            transform: translateY(0);
            box-shadow: 0 10px 24px rgba(34, 197, 94, 0.4);
            opacity: 0.95;
        }

        .button-small {
            margin-top: 8px;
            padding: 6px 14px;
            font-size: 12px;
        }

        /* =========================
           2. Результат розрахунку
           ========================= */

        .lait-result {
            margin-top: 22px;
        }

        .lait-result-card {
            border-radius: 24px;
            padding: 20px 24px 22px;
            background: linear-gradient(135deg, #eafff2, #f4fdf8);
            border: 1px solid rgba(34, 197, 94, 0.40);
            box-shadow: 0 20px 45px rgba(34, 197, 94, 0.25);
            color: #052e16;
        }

        .lait-result-main {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: flex-end;
            gap: 16px;
            margin-bottom: 18px;
        }

        .lait-result-label {
            font-size: 13px;
            color: #166534;
        }

        .lait-result-value {
            font-size: 28px;
            font-weight: 700;
            line-height: 1.1;
        }

        .lait-result-note {
            margin-top: 4px;
            font-size: 12px;
            color: #166534;
        }

        .lait-result-note-sub {
            margin-top: 4px;
            font-size: 11px;
            color: #15803d;
        }

        .lait-result-bottom {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: center;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 12px;
            color: #166534;
        }

        .lait-result-form {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 12px;
            margin-bottom: 14px;
        }

        .lait-result-field label {
            display: block;
            font-size: 12px;
            margin-bottom: 4px;
            color: #065f46;
        }

        .lait-result-field input {
            width: 100%;
            border-radius: 999px;
            border: 1px solid rgba(22, 163, 74, 0.4);
            padding: 7px 10px;
            font-size: 13px;
            color: #052e16;
            outline: none;
            background: #ffffff;
        }

        .lait-result-field input::placeholder {
            color: #16a34a;
        }

        /* режим клієнт / менеджер */

        .lait-result-mode {
            display: flex;
            gap: 8px;
            align-items: center;
            font-size: 12px;
            color: #065f46;
            margin-top: 6px;
        }

        .lait-mode-btn {
            border-radius: 999px;
            border: 1px solid rgba(22, 163, 74, 0.4);
            background: #ffffff;
            color: #065f46;
            padding: 4px 10px;
            font-size: 11px;
            cursor: pointer;
        }

        .lait-mode-btn.active {
            background: #22c55e;
            border-color: #22c55e;
            color: #052e16;
        }

        /* кнопка відправки */

        .lait-send-btn {
            margin-top: 6px;
            padding: 10px 20px;
            border-radius: 999px;
            border: none;
            background: #22c55e;
            color: #052e16;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 14px 30px rgba(34, 197, 94, 0.45);
        }

        .lait-send-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 18px 40px rgba(34, 197, 94, 0.65);
        }

        /* текст для Telegram */

        .tg-box {
            margin-top: 8px;
        }

        .tg-textarea {
            width: 100%;
            min-height: 120px;
            border-radius: 12px;
            border: 1px solid rgba(148, 163, 184, 0.6);
            background: #ffffff;
            color: #0f172a;
            font-size: 12px;
            padding: 8px 10px;
            resize: vertical;
        }

        .row {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
        }

        .rowSmall {
            font-size: 12px;
            color: #6b7280;
            margin-top: 2px;
        }

        .rowStrong {
            font-size: 13px;
            font-weight: 600;
            margin-top: 6px;
        }

        @media (max-width: 960px) {
            .lait-result-form {
                grid-template-columns: minmax(0, 1fr);
            }
        }

        /* ===== Переваги LAIT ===== */

        #lait-advantages {
            padding-top: 40px;
            padding-bottom: 40px;
        }

        .lait-adv-header {
            max-width: 720px;
            margin: 0 auto 20px;
            text-align: left;
        }

        .lait-adv-title {
            font-size: clamp(24px, 3vw, 30px);
            font-weight: 700;
            margin: 0 0 6px;
        }

        .lait-adv-sub {
            margin: 0;
            font-size: 14px;
            color: #6b7280;
        }

        .lait-adv-grid {
            display: grid;
            gap: 18px;
        }

        @media (min-width: 900px) {
            .lait-adv-grid {
                grid-template-columns: repeat(3, minmax(0, 1fr));
            }
        }

        .lait-adv-card {
            border-radius: 20px;
            padding: 16px 18px 18px;
            background: #ffffff;
            border: 1px solid rgba(15, 23, 42, 0.06);
            box-shadow: 0 16px 40px rgba(15, 23, 42, 0.06);
        }

        .lait-adv-card h3 {
            margin: 6px 0 6px;
            font-size: 15px;
        }

        .lait-adv-card p {
            margin: 0 0 10px;
            font-size: 13px;
            color: #4b5563;
        }

        .lait-adv-pill {
            display: inline-flex;
            align-items: center;
            padding: 3px 10px;
            border-radius: 999px;
            background: #ecfeff;
            color: #0e7490;
            font-size: 11px;
            font-weight: 500;
        }

        .lait-adv-media img {
            width: 100%;
            border-radius: 14px;
            display: block;
        }

        /* ===== Технічні схеми LAIT ===== */

        #lait-tech.section-dark {
            padding-top: 40px;
            padding-bottom: 48px;
            background: radial-gradient(circle at top left, #0f172a, #020617);
        }

        .lait-tech-header {
            max-width: 760px;
            margin: 0 auto 24px;
        }

        .lait-tech-title {
            font-size: clamp(24px, 3vw, 30px);
            font-weight: 700;
            margin: 0 0 6px;
            color: #f9fafb;
        }

        .lait-tech-sub {
            margin: 0;
            font-size: 14px;
            color: #9ca3af;
        }

        .lait-tech-grid {
            display: grid;
            gap: 20px;
        }

        @media (min-width: 960px) {
            .lait-tech-grid {
                grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.1fr);
            }
        }

        .lait-tech-text {
          display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .lait-tech-text h3 {
            margin: 0 0 6px;
            font-size: 15px;
            color: #e5e7eb;
        }

        .lait-tech-text ul {
            margin: 0 0 14px;
            padding-left: 18px;
            font-size: 13px;
            color: #cbd5f5;
        }

        .lait-tech-text li {
            margin-top: 4px;
            color:  #4b5563;
        }

        .lait-tech-media {
            display: grid;
            gap: 12px;
        }

        .lait-tech-figure {
            margin: 0;
            width: 56%;
            border-radius: 18px;
            background: rgba(15, 23, 42, 0.9);
            border: 1px solid rgba(148, 163, 184, 0.45);
            padding: 10px;
        }

        .lait-tech-figure img {
            width: 100%;
           display: block;
            border-radius: 12px;
        }

        .lait-tech-figure figcaption {
            margin-top: 6px;
            font-size: 12px;
            color: #9ca3af;
        }

        /* Dark / light адаптація для верхнього блоку */

        body.dark-theme #lait-advantages {
            background: radial-gradient(circle at top left, #020617, #020617 55%);
        }

        body.dark-theme #lait-advantages .lait-adv-title {
            color: #f9fafb;
        }

        body.dark-theme #lait-advantages .lait-adv-sub {
            color: #9ca3af;
        }

        body.dark-theme .lait-adv-card {
            background: rgba(15, 23, 42, 0.96);
            border-color: rgba(148, 163, 184, 0.45);
            box-shadow: 0 18px 50px rgba(15, 23, 42, 0.9);
        }

        body.dark-theme .lait-adv-card p {
            color: #e5e7eb;
        }

        /* =========================
           3. LAIT — DARK THEME (body.dark-theme)
           ========================= */

        body.dark-theme .lait-root {
            background: radial-gradient(circle at top left, #020617, #020617 55%);
            border: 1px solid rgba(148, 163, 184, 0.4);
            box-shadow: 0 24px 60px rgba(15, 23, 42, 0.9);
            color: #e5e7eb;
        }

        body.dark-theme .lait-root-title {
            color: #f9fafb;
        }

        body.dark-theme .lait-panel {
            background: rgba(15, 23, 42, 0.96);
            border: 1px solid rgba(148, 163, 184, 0.45);
            box-shadow: 0 18px 50px rgba(15, 23, 42, 0.9);
            color: #e5e7eb;
        }

        body.dark-theme .lait-intro {
            color: #9ca3af;
        }

        body.dark-theme .lait-bullets {
            color: #e5e7eb;
        }

        body.dark-theme .field label {
            color: #cbd5f5;
        }

        body.dark-theme .field input,
        body.dark-theme .field select {
            background: rgba(15, 23, 42, 0.85);
            border-color: rgba(148, 163, 184, 0.7);
            color: #f5f5f5;
        }

        body.dark-theme .field input::placeholder {
            color: #64748b;
        }

        body.dark-theme .field input:focus,
        body.dark-theme .field select:focus {
            border-color: #4f46e5;
            box-shadow: 0 0 0 1px rgba(79, 70, 229, 0.6);
        }

        body.dark-theme .button {
            background: #22c55e;
            color: #052e16;
            box-shadow: 0 14px 30px rgba(34, 197, 94, 0.45);
        }

        /* результат у темній темі */

        body.dark-theme .lait-result-card {
            background: radial-gradient(circle at top left, #064e3b, #020617 65%);
            border-color: rgba(34, 197, 94, 0.45);
            box-shadow: 0 20px 45px rgba(15, 23, 42, 0.85);
            color: #ecfdf5;
        }

        body.dark-theme .lait-result-label {
            color: #bbf7d0;
        }

        body.dark-theme .lait-result-note {
            color: #bbf7d0;
        }

        body.dark-theme .lait-result-note-sub {
            color: #a7f3d0;
        }

        body.dark-theme .lait-result-field label {
            color: #bbf7d0;
        }

        body.dark-theme .lait-result-field input {
            background: rgba(15, 23, 42, 0.9);
            border-color: rgba(74, 222, 128, 0.7);
            color: #ecfdf5;
        }

        body.dark-theme .lait-result-field input::placeholder {
            color: #6ee7b7;
        }

        body.dark-theme .lait-mode-btn {
            background: transparent;
            border-color: rgba(22, 163, 74, 0.7);
            color: #bbf7d0;
        }

        body.dark-theme .lait-mode-btn.active {
            background: #22c55e;
            border-color: #22c55e;
            color: #052e16;
        }

        body.dark-theme .lait-send-btn {
            background: #22c55e;
            color: #052e16;
            box-shadow: 0 16px 36px rgba(34, 197, 94, 0.6);
        }

        body.dark-theme .tg-textarea {
            background: rgba(15, 23, 42, 0.9);
            color: #e5e7eb;
            border-color: rgba(148, 163, 184, 0.7);
        }

        body.dark-theme .rowSmall {
            color: #d1d5db;
        }

    
/* ===== LAIT polish: consistent media + nav pills ===== */
.section-nav{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin:14px 0 0;
}
.nav-pill{
  border:1px solid rgba(255,255,255,.14);
  background:rgba(10,14,28,.35);
  color:#e9edff;
  padding:8px 12px;
  border-radius:999px;
  font-size:13px;
  cursor:pointer;
  transition:transform .08s ease, background .2s ease, border-color .2s ease;
}
.nav-pill:hover{ background:rgba(10,14,28,.55); border-color:rgba(255,255,255,.22); }
.nav-pill:active{ transform:translateY(1px); }

.lait-adv-media img{
  width:100%;
  height:180px;
  object-fit:cover;
  border-radius:16px;
}
.lait-tech-figure{
  width:100% !important;
  max-width:560px;
  margin-left:auto;
}
.lait-tech-figure img{
  width:100%;
  height:220px;
  object-fit:cover;
  border-radius:16px;
}
.lait-tech-text li{ color:rgba(233,237,255,.86); }
/* CTA button links should work in local html */
.etse-cta .btn-outline, .etse-cta .btn-white{ text-decoration:none; }

        /* ===== eTSecutive CTA ===== */

        .etse-cta {
            margin-top: 40px;
        }

        .etse-cta__inner {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: space-between;
            align-items: stretch;

            padding: 26px 30px;
            border-radius: 28px;
            background: linear-gradient(135deg, #16a34a, #22c55e);
            box-shadow: 0 22px 40px rgba(22, 163, 74, 0.45);
            color: #f9fafb;
        }

        .etse-cta__left {
            flex: 1 1 260px;
            min-width: 260px;
            max-width: 520px;
        }

        .etse-cta__title {
            margin: 0 0 8px;
            font-size: 24px;
            line-height: 1.25;
        }

        .etse-cta__text {
            margin: 0 0 18px;
            font-size: 14px;
            opacity: 0.96;
        }

        .etse-cta__actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .etse-cta__btn {
            border-radius: 999px;
            padding: 10px 18px;
            font-size: 13px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: transform 0.15s ease, box-shadow 0.15s ease,
            background 0.15s ease, color 0.15s ease, border-color 0.15s ease;
        }

        .etse-cta__btn--primary {
            background: #f9fafb;
            color: #15803d;
            box-shadow: 0 10px 25px rgba(15, 23, 42, 0.18);
        }

        .etse-cta__btn--primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 16px 35px rgba(15, 23, 42, 0.26);
        }

        .etse-cta__btn--ghost {
            background: rgba(15, 23, 42, 0.08);
            color: #ecfdf5;
            border: 1px solid rgba(226, 232, 240, 0.6);
        }

        .etse-cta__btn--ghost:hover {
            background: rgba(15, 23, 42, 0.16);
        }

        /* Контактна картка справа */

        .etse-cta__contacts {
            flex: 0 0 280px;
            max-width: 320px;
            padding: 18px 20px;
            border-radius: 22px;

            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(12px);

            border: 1px solid rgba(255, 255, 255, 0.35);
            color: #0f172a;

            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        }

        .etse-cta__contacts-row + .etse-cta__contacts-row {
            margin-top: 10px;
        }

        .etse-cta__contacts-label {
            opacity: 0.7;
            margin-bottom: 2px;
        }

        .etse-cta__contacts-value {
            font-weight: 500;
        }

        /* Мобільна адаптація */

        @media (max-width: 768px) {
            .etse-cta__inner {
                padding: 20px 18px;
                flex-direction: column;
                align-items: flex-start;
            }

            .etse-cta__title {
                font-size: 20px;
            }

            .etse-cta__contacts {
                width: 100%;
                max-width: none;
            }

            .etse-cta__actions {
                justify-content: flex-start;
            }
        }


</style>

</head>
<body>
<div class="page">

    <!-- TOPBAR -->
    <header class="topbar" >
        <div class="topbar-left">
            <div class="topbar-logo">
                <img src="/images/MT_logo_ua_Kubik.jpg" alt="MT logo">
            </div>
            <div>
                <div class="topbar-title">MT Україна</div>
                <div class="topbar-sub">Полиці LAIT (Lite) · калькулятор + вітрина</div>
            </div>
        </div>

        <div class="theme-toggle">
            <button id="themeToggle"><span></span> Темна тема</button>
        </div>
    </header>

    <!-- HERO -->
    <section class="hero" id="top">
        <div class="hero-content">
            <h1 class="hero-title">Легка система скляних полиць</h1>

            <p class="hero-sub">
                Легка система скляних полиць з інтегрованим світлом: профілі LA-1048 / LA-1049, кронштейни LA-B, LED Domus APEX SHE та конвертери 24V.
            </p>
            <p class="hero-sub">
                Готове рішення для гардеробних, вітрин і ніш. Працює як доповнення до TRIAL / eTSecutive або як окрема полиця.
            </p>

            <div class="hero-tags">
                <span>профілі LA-1048 / LA-1049</span>
                <span>Скло</span>
                <span>кронштейни LA-B</span>
                <span>LED Domus APEX SHE</span>
            </div>

            <div class="section-nav">
                <button class="nav-pill" type="button" data-scroll="#lait-lite-calculator">Калькулятор</button>
                <button class="nav-pill" type="button" data-scroll="#lait-lite-showcase">Переваги</button>
                <button class="nav-pill" type="button" data-scroll="#lait-tech">Техдані</button>
                <button class="nav-pill" type="button" data-scroll="#contact">Контакти</button>
            </div>

            <button class="btn-green" onclick="document.getElementById('lait-lite-calculator').scrollIntoView({behavior:'smooth'})">
                Зібрати полку
            </button>
            <button class="btn-white" onclick="document.getElementById('lait-lite-showcase').scrollIntoView({behavior:'smooth'})">
                Дивитись приклади
            </button>
        </div>

        <div class="hero-image">
            <img src="/images/lait.png" alt="Система Lait"/>
        </div>
    </section>

    <section id="lait-lite-showcase">
        <div class="lait-grid-2">
            <!-- Де застосовувати -->
            <div class="card">
                <div class="card-title">Де застосовувати</div>
                <div class="card-body">
                    <ul class="lait-bullets">
                        <li>Гардеробні та шафи-купе.</li>
                        <li>Ніші у спальнях та вітальнях.</li>
                        <li>Зони продажу та вітрини в магазинах.</li>
                    </ul>
                </div>
            </div>

            <!-- Конструкція полиці -->
            <div class="card">
                <div class="card-title">Конструкція полиці</div>
                <div class="card-body">
                    <ul class="lait-bullets">
                        <li>Рамка з алюмінієвих профілів <strong>LA-1048</strong> (фронт під світло) та <strong>LA-1049</strong> (бокові/задня частина).</li>
                        <li>Наповнення — скло 4–6 мм (гартоване) або ДСП 18 мм з вибіркою чверті.</li>
                        <li>Кронштейни <strong>LA-B</strong> підбираються під довжину полиці.</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="lait-grid-2" style="margin-top:18px;">
            <!-- Скло / ДСП -->
            <div class="card">
                <div class="card-title">Скло / ДСП та обробка</div>
                <div class="card-body">
                    <ul class="lait-bullets">
                        <li>Скло гартоване/не гартоване з поліруванням кромок.</li>
                        <li>Розрахунок площі та вартості.</li>
                        <li>ДСП 18 мм без кромки, з чвертю під профіль LA-1048/1049.</li>
                    </ul>
                </div>
            </div>

            <!-- LED-версія -->
            <div class="card">
                <div class="card-title">LED-версія</div>
                <div class="card-body">
                    <ul class="lait-bullets">
                        <li>У профіль LA-1048 вбудовується LED-стрічка Domus APEX SHE 24V.</li>
                        <li>Калькулятор рахує довжину LED-стрічки та підбирає конвертер 24V.</li>
                        <li>Можливі варіанти: лише полиця, полиця + LED, полиця + LED + монтаж.</li>
                    </ul>
                </div>
            </div>
        </div>


        <!-- Як працювати з MTU -->
        <section style="margin-top:32px;">
            <h2 class="section-headline">Як працювати з LAIT</h2>
            <p class="section-lead">
                Ви можете замовити повний комплект LAIT: профіль, скло, LED та роботи в одному місці. Ми робимо різку, збірку,
                поклейку скла та готуємо полиці до монтажу.
            </p>

            <div class="card lait-note-card">
                <div class="card-body">
                    <ul class="lait-bullets">
                        <li><strong>Комплект «під ключ»</strong> зі складу: профіль, скло, LED, конвертер, роботи.</li>
                        <li><strong>Варіант «тільки профіль + сервіс»</strong> — скло від вашого постачальника, ми робимо розкрій і підготовку профілю.</li>
                        <li><strong>Підтримка менеджера</strong> на етапі проєктування полиць, перевірка навантажень та вузлів.</li>
                    </ul>
                </div>
            </div>
        </section>
    </section>

    <!-- КАЛЬКУЛЯТОР LAIT (Lite) -->
    <section id="lait-lite-calculator" style="margin-top:40px;">
        <h2 class="section-headline">Калькулятор полиць LAIT (Lite)</h2>
        <p class="section-lead">
            Вкажіть параметри полиць. Калькулятор дає детальний розрахунок профілю, скла / ДСП, LED, конвертерів та послуг.
            Менеджер MT перевіряє результат перед виставленням рахунку.
        </p>

        <div class="lait-root">
            <h3 class="lait-root-title">Вхідні дані</h3>

            <div class="lait-calc-grid">
                <!-- Ліва частина — форма -->
                <div class="lait-panel lait-panel--inputs">
                    <div class="lait-grid">
                        <div class="field">
                            <label for="eurRate">Курс EUR, грн</label>
                            <input id="eurRate" type="number" value="49.5" step="0.01" />
                        </div>
                        <div class="field">
                            <label for="lengthMm">Довжина полиці, мм</label>
                            <input id="lengthMm" type="number" value="900" />
                        </div>
                        <div class="field">
                            <label for="depthMm">Глибина полиці, мм</label>
                            <input id="depthMm" type="number" value="600" />
                        </div>
                        <div class="field">
                            <label for="quantity">Кількість полиць</label>
                            <input id="quantity" type="number" value="2" min="1" />
                        </div>

                        <div class="field">
                            <label for="finishId">Оздоблення профілю</label>
                            <select id="finishId">
                                <option value="black">Чорний мат</option>
                                <option value="bronze_cartier">Бронза Карт’є</option>
                                <option value="bronze_armani">Бронза Armani</option>
                            </select>
                        </div>

                        <div class="field">
                            <label for="infillType">Наповнення</label>
                            <select id="infillType">
                                <option value="glass">Скло</option>
                                <option value="board">ДСП 18 мм (під четверть)</option>
                            </select>
                        </div>


                        <div class="field" id="glassSupplierField">
                                                       <label for="glassSupplier">Постачальник скла</label>
                                                       <select id="glassSupplier">
                                                           <option value="busel" selected>Варіант B</option>
                                                           <option value="abstract">Варіант A</option>

                                                       </select>
                                                        <small>Впливає на джерело ціни та на послуги по склу.</small>
                                                  </div>

                        <div class="field" id="glassField">
                            <label for="glassId">Тип скла</label>
                            <select id="glassId">
                                <option value="float_clear_4">Скло Float прозоре 4 мм</option>
                                <option value="float_clear_5" selected>Скло Float прозоре 5 мм</option>
                                <option value="float_clear_6">Скло Float прозоре 6 мм</option>

                                <option value="extra_clear_4">Скло Extra-clear 4 мм (Діамант / low-iron)</option>
                                <option value="extra_clear_5">Скло Extra-clear 5 мм (Діамант / low-iron)</option>
                                <option value="extra_clear_6">Скло Extra-clear 6 мм (Діамант / low-iron)</option>

                                <option value="dark_grey_4">Скло Dark Grey 4 мм (тоноване)</option>
                                <option value="dark_grey_6">Скло Dark Grey 6 мм (тоноване)</option>

                                <option value="satin_extra_clear_4">Скло Satin Extra Clear 4 мм (матове)</option>
                                <option value="satin_extra_clear_6">Скло Satin Extra Clear 6 мм (матове)</option>
                            </select>
                        </div>

                        <div class="field" id="glassHeatField">
                            <label for="glassHeat">Термообробка</label>
                            <select id="glassHeat">
                                <option value="tempered" selected>Загартоване</option>
                                <option value="not_tempered">Не загартоване</option>
                            </select>

                        </div>


                        <div class="field">
                            <label for="ledType">LED-підсвітка</label>
                            <select id="ledType">
                                <option value="none">Без LED</option>
                                <option value="led_domus_apex_she" selected>Domus Apex SHE 24V</option>
                                <option value="led_diffuser_2800">LED розсіювач 2800 мм</option>
                            </select>
                        </div>

                    </div>

                    <button id="calcBtn" class="button" type="button">Розрахувати</button>

                    <!-- Блок з результатом та формою заявки -->
                    <section class="lait-result" id="lait-result">
                        <h2 class="section-headline">Результат розрахунку</h2>
                        <p id="lait-result-summary" class="section-lead">
                            Після натискання «Розрахувати» тут зʼявиться короткий підсумок по полиці LAIT.
                        </p>

                        <div class="lait-result-card">
                            <div class="lait-result-main">
                                <div>
                                    <div class="lait-result-label">Орієнтовна вартість комплекту</div>
                                    <div class="lait-result-value">
                                        <span id="lait-total-eur">0.00</span> €
                                    </div>
                                </div>
                                <div class="lait-result-note">
                                    або <span id="lait-total-uah">0.00</span> грн<br />
                                    <span class="lait-result-note-sub">
                                        Ціна включає профілі, скло / ДСП, LED та послуги MT згідно поточного прорахунку.
                                    </span>
                                </div>
                            </div>

                            <div class="lait-result-form">
                                <div class="lait-result-field">
                                    <label for="lait-name">Імʼя</label>
                                    <input id="lait-name" type="text" placeholder="Ваше імʼя">
                                </div>
                                <div class="lait-result-field">
                                    <label for="lait-phone">Телефон</label>
                                    <input id="lait-phone" type="tel" placeholder="+380…">
                                </div>
                                <div class="lait-result-field">
                                    <label for="lait-email">Email (необовʼязково)</label>
                                    <input id="lait-email" type="email" placeholder="email@example.com">
                                </div>
                            </div>

                            <div class="lait-result-bottom">
                                <div class="lait-result-mode">
                                    Режим:
                                    <button
                                            id="lait-mode-client"
                                            class="lait-mode-btn active"
                                            data-mode="client"
                                            type="button"
                                            onclick="setLaitMode('client')"
                                    >
                                        клієнт
                                    </button>
                                    <button
                                            id="lait-mode-manager"
                                            class="lait-mode-btn"
                                            data-mode="manager"
                                            type="button"
                                            onclick="setLaitMode('manager')"
                                    >
                                        менеджер
                                    </button>
                                </div>

                                <button type="button" id="lait-send-btn" class="lait-send-btn">
                                    Надіслати заявку в MT × Systems
                                </button>
                            </div>
                        </div>
                    </section>

                </div>

                <!-- Права частина — результати (3 картки hub) -->
                <div class="lait-results-wrapper" id="resultsContainer">
                    <div class="results">
                        <div class="lait-panel">
                            <h3 class="card-title">Підсумок по полиці</h3>
                            <div id="shelvesSummary"></div>
                        </div>

                        <div class="lait-panel">
                            <h3 class="card-title">Матеріали</h3>

                            <div class="section">
                                <h3>Профілі (факт / до оплати)</h3>
                                <div id="profilesSummary"></div>
                            </div>

                            <div class="section">
                                <h3>Скло</h3>
                                <div id="glassSummary"></div>
                            </div>

                            <div class="section">
                                <h3>ДСП</h3>
                                <div id="boardsSummary"></div>
                            </div>

                            <div class="section">
                                <h3>Кронштейни</h3>
                                <div id="bracketsSummary"></div>
                            </div>

                            <div class="section">
                                <h3>Конектори рамки</h3>
                                <div id="connectorsSummary"></div>
                            </div>

                            <div class="section">
                                <h3>LED</h3>
                                <div id="ledSummary"></div>
                            </div>

                            <div class="section">
                                <h3>Живлення (конвертер + конектор живлення)</h3>
                                <div id="powerSummary"></div>
                            </div>
                        </div>

                        <div class="lait-panel">
                            <h3 class="card-title">Послуги та загальні суми</h3>

                            <div class="section">
                                <h3>Послуги</h3>
                                <div id="servicesSummary"></div>
                            </div>

                            <div class="section">
                                <div class="rowSmall" id="materialsTotal"></div>
                                <div class="rowSmall" id="servicesTotal"></div>
                                <div class="rowStrong" id="grandTotal"></div>
                            </div>

                            <div class="section">
                                <h3>Пояснення для менеджера</h3>
                                <div id="explainManager"></div>
                            </div>

                            <!-- Секція з текстом Telegram схована, textarea використовується лише для відправки -->
                            <div class="section" id="telegramSection" style="display:none;">
                                <h3>Текст заявки в Telegram</h3>
                                <div class="tg-box">
                                    <textarea id="telegramText" class="tg-textarea" readonly></textarea>
                                    <button id="copyTelegram" class="button button-small" type="button">
                                        Скопіювати текст
                                    </button>
                                </div>
                            </div>

                        </div>
                    </div>
                </div> <!-- /resultsContainer -->
            </div> <!-- /lait-calc-grid -->
        </div> <!-- /lait-root -->
    </section>
    <!-- ===== ПЕРЕВАГИ СИСТЕМИ LAIT ===== -->
    <section class="lait-root" id="lait-advantages">
        <div class="container">

                <h2 class="section-headline">Переваги системи LAIT</h2>
                <p class="section-lead">
                    Система LAIT H30 поєднує алюмінієвий профіль, скло або ДСП, LED-підсвітку та кріплення
                    в одному рішенні. Полиці збираються з готових профілів LA-1048 / LA-1049, комплекту
                    тримачів LA-B та монтажних кутників.
                </p>


            <div class="lait-adv-grid">
                <!-- Карта 1 -->
                <article class="lait-adv-card">
                    <div class="lait-adv-pill">Конструкція полиці</div>
                    <h3>Готова архітектура LAIT H30</h3>
                    <p>
                        Полиці LAIT H30 збираються з фронтального профілю LA-1048 та бічного заднього
                        профілю LA-1049 (довжина 6100&nbsp;мм, висота 30&nbsp;мм, глибина 24&nbsp;мм).
                        Скляна полиця виконується з відступом <strong>H/L&nbsp;−&nbsp;5&nbsp;мм</strong> від габариту
                        профілю, товщина скла 4/5/6&nbsp;мм.
                    </p>
                    <div class="lait-adv-media">
                        <img src="images/lait/img457.jpg" alt="Полиця з підсвічуванням LAIT H30" loading="lazy">
                    </div>
                </article>

                <!-- Карта 2 -->
                <article class="lait-adv-card">
                    <div class="lait-adv-pill">Наповнення та світло</div>
                    <h3>Скло, ДСП та LED-підсвітка</h3>
                    <p>
                        У полицю LAIT можна встановити скло або плиту (ДСП/МДФ), а також LED-стрічку
                        (Domus Apex SHE 24V чи іншу сумісну) у фронтальний профіль. Блок живлення
                        з кабелем виноситься в окрему нішу шафи, що полегшує сервіс.
                    </p>
                    <div class="lait-adv-media">
                        <img src="images/lait/img43.jpg" alt="Схема полиці LAIT H30 з блоком живлення" loading="lazy">
                    </div>
                </article>

                <!-- Карта 3 -->
                <article class="lait-adv-card">
                    <div class="lait-adv-pill">Монтаж та регулювання</div>
                    <h3>Зручне кріплення та блокування</h3>
                    <p>
                        Кріплення полиці виконується на з’єднувальні кутники KIT-LA-G30-EL-GR та
                        комплект тримачів LA-B (Ø14,9&nbsp;мм, виступ 5,9&nbsp;мм). Після навішування полиця
                        блокується поворотом тримача — полиця фіксується та не вислизає зі стінки.
                    </p>
                    <div class="lait-adv-media">
                        <img src="images/lait/img455.jpg" alt="Монтаж та блокування полиці LAIT H30" loading="lazy">
                    </div>
                </article>
            </div>
        </div>
    </section>

    <!-- ===== ТЕХНІЧНІ СХЕМИ СИСТЕМИ LAIT ===== -->
    <section class="section" id="lait-tech">
        <div class="lait-root">
            <div class="container">
                <h2 class="section-headline">Технічні схеми системи LAIT</h2>
                <p class="section-lead">
                    Короткі технічні схеми з каталогу LAIT показують профілі LA-1048/LA-1049, комплект LA-B,
                    кутники KIT-LA-G30-EL-GR та послідовність монтажу полиці H30 у шафі.
                </p>
            </div>

            <div class="lait-tech-grid">
                <div class="lait-tech-text" >
                    <!-- Карта 1 -->
                    <article class="lait-adv-card">
                        <div class="lait-adv-pill">Профілі та комплектуючі</div>
                        <ul>
                            <li>
                                <strong>LA-1048 — фронтальний профіль</strong>, висота 30&nbsp;мм, глибина 24&nbsp;мм,
                                товщина лицевої частини 2&nbsp;мм, полиця спирається на внутрішню полицю профілю.
                            </li>
                            <li>
                                <strong>LA-1049 — бічний задній профіль</strong>, також 30×24&nbsp;мм, з полицею під скло/ДСП
                                та каналом для LED-стрічки.
                            </li>
                            <li>
                                <strong>LA-B — комплект тримачів</strong>: діаметр 14,9&nbsp;мм, виступ 5,9&nbsp;мм — служить
                                для фіксації полиці в стінці. На одну полицю йде 14&nbsp;шт (по 7 на бік).
                            </li>
                            <li>
                                <strong>KIT-LA-G30-EL-GR — з’єднувальний кутник</strong> для стику профілів та
                                кріплення полиці до бокової стінки.
                            </li>
                        </ul>
                    </article>

                    <article class="lait-adv-card">
                        <div class="lait-adv-pill">Монтаж полиці H30</div>
                        <ul>
                            <li>Збірка рами з профілів LA-1048 / LA-1049 на кутниках KIT-LA-G30-EL-GR.</li>
                            <li>Встановлення скла/плити в раму з зазором H/L&nbsp;−&nbsp;5&nbsp;мм.</li>
                            <li>Навішування полиці на тримачі LA-B з кроком 90&nbsp;мм від переднього краю.</li>
                            <li>Поворотом тримачів полиця блокується та не висовується зі стінки.</li>
                        </ul>
                    </article>
                                   </div>

                <div class="lait-tech-media">
                    <figure class="lait-tech-figure">
                        <img src="images/lait/img460.jpg" alt="Схема монтажу полиці LAIT H30 у шафі" loading="lazy">
                        <figcaption>Монтаж та блокування полиці H30 у боковій стінці шафи.</figcaption>
                    </figure>

                    <figure class="lait-tech-figure">
                        <img src="images/lait/img51.jpg" alt="Збірка рами полиці LAIT H30" loading="lazy">
                        <figcaption>Збірка рами з профілів LA-1048/LA-1049 та монтажним кутником.</figcaption>
                    </figure>
                </div>
            </div>
        </div>
    </section>
    <!-- FINAL CTA (LAIT Lite) -->
    <section id="contact" class="etse-cta">
        <div class="etse-cta__inner">
            <div class="etse-cta__left">
                <h2 class="etse-cta__title">Готові протестувати LAIT на реальному проєкті?</h2>
                <p class="etse-cta__text">
                    Запустіть калькулятор полиць LAIT (Lite), додайте свій комплект і надішліть результат у MT × Systems.
                    Ми допоможемо перевірити специфікацію, підберемо скло/LED та оптимальний формат співпраці.
                </p>

                <div class="etse-cta__actions">
                    <a
                            class="etse-cta__btn etse-cta__btn--primary"
                            href="lait_catalog.pdf"
                            target="_blank"
                            rel="noopener"
                    >
                        Завантажити PDF про LAIT (Lite)
                    </a>

                    <a
                            class="etse-cta__btn"
                            href="index.html"
                    >
                        Повернутися до виробничого центру MT
                    </a>
                </div>
            </div>

            <div class="etse-cta__contacts">
                <div class="etse-cta__contacts-row">
                    <div class="etse-cta__contacts-label">Телефон</div>
                    <div class="etse-cta__contacts-value">0-800-304-404</div>
                </div>

                <div class="etse-cta__contacts-row">
                    <div class="etse-cta__contacts-label">Email</div>
                    <div class="etse-cta__contacts-value">info@mt.ua</div>
                </div>

                <div class="etse-cta__contacts-row">
                    <div class="etse-cta__contacts-label">Адреса виробництва</div>
                    <div class="etse-cta__contacts-value">м. Київ, вул. Кирилівська, 102</div>
                </div>

                <div class="etse-cta__contacts-row">
                    <div class="etse-cta__contacts-label">Звʼязок по LAIT</div>
                    <div class="etse-cta__contacts-value">Telegram: @mt_systems</div>
                </div>
            </div>
        </div>
    </section>

</div>

<script>
    // ========= ТЕМА (як у головному hub) =========
    const bodyEl = document.body;
    const themeBtn = document.getElementById('themeToggle');

    function applyTheme(mode) {
        const isDark = mode === 'dark';
        if (isDark) {
            bodyEl.classList.add('dark-theme');
            themeBtn.innerHTML = '<span></span> Світла тема';
        } else {
            bodyEl.classList.remove('dark-theme');
            themeBtn.innerHTML = '<span></span> Темна тема';
        }
    }

    const savedTheme = localStorage.getItem('mtHubTheme') || 'light';
    applyTheme(savedTheme);

    themeBtn.addEventListener('click', () => {
        const newTheme = bodyEl.classList.contains('dark-theme') ? 'light' : 'dark';
        localStorage.setItem('mtHubTheme', newTheme);
        applyTheme(newTheme);
    });

    // ========= Константи режиму / Telegram =========
    const MANAGER_PASSWORD = "603"; // як у TRIAL
    const TELEGRAM_ENDPOINT = "https://mt-volpato.vercel.app/api/telegram";
    const TELEGRAM_FORM_SECRET = "mtx-volpato-2025";

    // ========= ДАНІ ДЛЯ LAIT (довідники + engine) =========

    const refData = {
        profilesLait: [
            {
                id: 'LA1048',
                name: 'Профіль LAIT фронтальний для світла, 6100мм',
                role: 'front',
                lengthMm: 6100,
                finishes: [
                    {id: 'black', name: 'Чорний мат', pricePerBar: 122.91, currency: 'EUR', article: 'трLA-1048-NS'},
                    {
                        id: 'bronze_cartier',
                        name: 'Бронза Карт’є',
                        pricePerBar: 104.81,
                        currency: 'EUR',
                        article: 'трLA-1048-BRC_св'
                    },
                    {
                        id: 'bronze_armani',
                        name: 'Бронза Armani',
                        pricePerBar: 110.97,
                        currency: 'EUR',
                        article: 'трLA-1048-BRA'
                    }
                ]
            },
            {
                id: 'LA1049',
                name: 'Профіль LAIT боковий і задній для полиці, 6100мм',
                role: 'side_back',
                lengthMm: 6100,
                finishes: [
                    {id: 'black', name: 'Чорний мат', pricePerBar: 112.46, currency: 'EUR', article: 'трLA-1049-NS'},
                    {
                        id: 'bronze_cartier',
                        name: 'Бронза Карт’є',
                        pricePerBar: 112.46,
                        currency: 'EUR',
                        article: 'трLA-1049-BRC_св'
                    },
                    {
                        id: 'bronze_armani',
                        name: 'Бронза Armani',
                        pricePerBar: 119.07,
                        currency: 'EUR',
                        article: 'трLA-1049-BRA'
                    }
                ]
            }
        ],

        glassLait: [
            {
                id: 'float_clear_4',
                name: 'Скло Float прозоре 4 мм (гарт.)',
                thicknessMm: 4,
                pricePerM2: 507.90,
                currency: 'UAH',
                tempered: true,
                article: 'GL-FLOAT-4'
            },
            {
                id: 'float_clear_5',
                name: 'Скло Float прозоре 5 мм (гарт.)',
                thicknessMm: 5,
                pricePerM2: 725.22,
                currency: 'UAH',
                tempered: true,
                article: 'GL-FLOAT-5'
            },
            {
                id: 'float_clear_6',
                name: 'Скло Float прозоре 6 мм (гарт.)',
                thicknessMm: 6,
                pricePerM2: 996.90,
                currency: 'UAH',
                tempered: true,
                article: 'GL-FLOAT-6'
            },
            {
                id: 'extra_clear_4',
                name: 'Скло Extra-clear 4 мм (Діамант / low-iron)',
                thicknessMm: 4,
                pricePerM2: 879.30,
                currency: 'UAH',
                tempered: true,
                article: 'GL-EXTRA-4'
            },
            {
                id: 'extra_clear_5',
                name: 'Скло Extra-clear 5 мм (Діамант / low-iron)',
                thicknessMm: 5,
                pricePerM2: 1203.48,
                currency: 'UAH',
                tempered: true,
                article: 'GL-EXTRA-5'
            },
            {
                id: 'extra_clear_6',
                name: 'Скло Extra-clear 6 мм (Діамант / low-iron)',
                thicknessMm: 6,
                pricePerM2: 1403.4,
                currency: 'UAH',
                tempered: true,
                article: 'GL-EXTRA-6'
            },
            {
                id: 'dark_grey_4',
                name: 'Скло Dark Grey 4 мм (тоноване, гарт.)',
                thicknessMm: 4,
                pricePerM2: 1683,
                currency: 'UAH',
                tempered: true,
                article: 'GL-GREY-4'
            },
            {
                id: 'dark_grey_6',
                name: 'Скло Dark Grey 6 мм (тоноване, гарт.)',
                thicknessMm: 6,
                pricePerM2: 2863.08,
                currency: 'UAH',
                tempered: true,
                article: 'GL-GREY-6'
            },
            {
                id: 'satin_extra_clear_4',
                name: 'Скло Satin Extra Clear 4 мм (матове, гарт.)',
                thicknessMm: 4,
                pricePerM2: 1306.26,
                currency: 'UAH',
                tempered: true,
                article: 'GL-SATIN-4'
            },
            {
                id: 'satin_extra_clear_6',
                name: 'Скло Satin Extra Clear 6 мм (матове, гарт.)',
                thicknessMm: 6,
                pricePerM2: 1918.62,
                currency: 'UAH',
                tempered: true,
                article: 'GL-SATIN-6'
            }
        ],

        // AbstractGlass (етап 1: дубль структури LAIT, ціни можна замінити на свої)
           glassLaitAbstract: [
            // AbstractGlass (короткий прайс): ціна UAH/м² за скло (без гарт/матування).
            // Гартування та матування (Satin) додаємо в розрахунку.
            { id:'float_clear_4',  name:'Скло звичайне 4 мм', thicknessMm:4, pricePerM2:690.0, currency:'UAH', article:'AG-FLOAT_CLEAR_4' },
            { id:'float_clear_5',  name:'Скло звичайне 5 мм', thicknessMm:5, pricePerM2:890.0, currency:'UAH', article:'AG-FLOAT_CLEAR_5' },
            { id:'float_clear_6',  name:'Скло звичайне 6 мм', thicknessMm:6, pricePerM2:1100.0, currency:'UAH', article:'AG-FLOAT_CLEAR_6' },

            { id:'extra_clear_4',  name:'Скло ДІАМАНТ 4 мм', thicknessMm:4, pricePerM2:980.0, currency:'UAH', article:'AG-EXTRA_CLEAR_4' },
            { id:'extra_clear_5',  name:'Скло ДІАМАНТ 5 мм', thicknessMm:5, pricePerM2:1285.0, currency:'UAH', article:'AG-EXTRA_CLEAR_5' },
            { id:'extra_clear_6',  name:'Скло ДІАМАНТ 6 мм', thicknessMm:6, pricePerM2:1590.0, currency:'UAH', article:'AG-EXTRA_CLEAR_6' },

            { id:'dark_grey_4',    name:'Скло ГРАФІТ 4 мм', thicknessMm:4, pricePerM2:1180.0, currency:'UAH', article:'AG-DARK_GREY_4' },
            { id:'dark_grey_5',    name:'Скло ГРАФІТ 5 мм', thicknessMm:5, pricePerM2:1500.0, currency:'UAH', article:'AG-DARK_GREY_5' },
            { id:'dark_grey_6',    name:'Скло ГРАФІТ 6 мм', thicknessMm:6, pricePerM2:1795.0, currency:'UAH', article:'AG-DARK_GREY_6' },

            { id:'satin_extra_clear_4', name:'Скло ДІАМАНТ 4 мм (матування полотна)', thicknessMm:4, pricePerM2:980.0, currency:'UAH', article:'AG-SATIN_EXTRA_CLEAR_4', isSatin:true },
            { id:'satin_extra_clear_6', name:'Скло ДІАМАНТ 6 мм (матування полотна)', thicknessMm:6, pricePerM2:1590.0, currency:'UAH', article:'AG-SATIN_EXTRA_CLEAR_6', isSatin:true },
        ],


        boardLait: [
            {
                id: 'board_18mm_generic',
                name: 'ДСП 18 мм (під четверть для LAIT, без кромки)',
                thicknessMm: 18,
                pricePerM2: 590,
                currency: 'UAH',
                quarterDepthMm: 8,
                seatThicknessMm: 10,
                article: 'BOARD-18-LAIT'
            }
        ],

        ledLait: [
            {
                id: 'led_domus_apex_she',
                name: 'Domus APEX SHE 24V',
                pricingMode: 'perMeter',
                pricePerM: 2125,
                currency: 'UAH',
                powerWPerM: 13.9,
                needsDriver: true,
                note: 'Монтаж у профіль LA1048',
                article: 'DOMUS-APEX-SHE'
            },
            {
                id: 'led_diffuser_2800',
                name: 'LED розсіювач 2800 мм',
                pricingMode: 'perPiece',
                pieceLengthMm: 2800,
                pricePerPiece: 1017.00,
                currency: 'UAH',
                powerWPerM: 0,
                needsDriver: false,
                article: 'boMNSLP2800'
            }
        ],

        bracketsLait: [
            {
                id: 'holder_LA_B',
                name: 'Тримач полиці LA-B (4 шт/комплект)',
                mountType: 'side_panel',
                pricePerPc: 7.42 / 4,
                currency: 'EUR',
                minQtyPerShelfUpToMm: 900,
                minQtyBelowOrEqualSpan: 2,
                minQtyAboveSpan: 3,
                maxSpanMm: 1200,
                article: 'трLA-B'
            }
        ],

        connectorsLait: [
            {
                id: 'connector_kit_LAIT',
                name: 'Комплект з’єднувальних елементів для полиці LAIT (4 шт.)',
                pricePerKit: 17.88,
                currency: 'EUR',
                pcsPerKit: 4,
                article: 'трKIT-LA-G30-EL-GR'
            }
        ],

        convertersLait: [
            {
                id: 'conv30',
                name: 'Конвертер 24V 30W',
                powerW: 30,
                priceUah: 1150,
                currency: 'UAH',
                article: 'DL-CONV-30'
            },
            {
                id: 'conv60',
                name: 'Конвертер 24V 60W',
                powerW: 60,
                priceUah: 1800,
                currency: 'UAH',
                article: 'DL-CONV-60'
            },
            {
                id: 'conv90',
                name: 'Конвертер 24V 90W',
                powerW: 90,
                priceUah: 3000,
                currency: 'UAH',
                article: 'DL-CONV-90'
            },
            {
                id: 'conv150',
                name: 'Конвертер 24V 150W',
                powerW: 150,
                priceUah: 3500,
                currency: 'UAH',
                article: 'DL-CONV-150'
            }
        ],

        powerConnectorLait: {
            id: 'ol_conn_n',
            name: 'Конектор живлення OL-CONN-N (Domus Line)',
            priceUah: 80,
            currency: 'UAH',
            article: 'OL-CONN-N'
        },

        servicesLait: [
            {
                id: 'srv_cut_profile_lait',
                name: 'Порізка та свердлівка профілю на одну полицю (087366)',
                unit: 'shelf',
                pricePerUnit: 1150.00,
                currency: 'UAH',
                article: '087366'
            },
            {
                id: 'srv_assemble_frame_lait',
                name: 'Збірка полиці LAIT (без приклеювання скла) (116357)',
                unit: 'shelf',
                pricePerUnit: 675.00,
                currency: 'UAH',
                article: '116357'
            },
            {
                id: 'srv_install_glass_lait',
                name: 'Поклейка скла на профіль LAIT (до 1 м²) (123125)',
                unit: 'm2',
                pricePerUnit: 600,
                currency: 'UAH',
                article: '123125'
            },
            {
                id: 'srv_quarter_board_lait',
                name: 'Вибірка четверті під ДВП, ДСП (044275)',
                unit: 'm',
                pricePerUnit: 50.00,
                currency: 'UAH',
                article: '044275'
            },
            {
                id: 'srv_install_led_lait',
                name: 'Монтаж LED-підсвітки в полицю LAIT (102907)',
                unit: 'shelf',
                pricePerUnit: 15,
                currency: 'UAH',
                article: '102907'
            }
        ],

        constantsLait: {
            glassOffsetMm: 5,
            ledOffsetMm: 10
        }
    };

    function toUAH(value, currency, eurRate) {
        return currency === 'EUR' ? value * eurRate : value;
    }

    
    // ===== Скло: Busel / Abstract (з термообробкою) =====
    function calcGlassForLait({
        supplierGlassId, // id зі списку (наприклад 'float_clear_4')
        widthMm,
        heightMm,
        pricePerM2,
        thicknessMm,
        supplier,        // 'busel' | 'abstract' | 'client'
        heat,            // 'tempered' | 'not_tempered'
        isSatin,
        edgePolishPerM,
        batchAreaM2      // площа партії гартування (для Busel coef batch). якщо не передано — беремо billingArea
    }) {
        const rawArea = (widthMm * heightMm) / 1_000_000;
        const billingArea = Math.max(rawArea, 0.25);
        const edgeLenM = (2 * (widthMm + heightMm)) / 1000;

        // Табл.2 (Busel): коеф. від площі виробу
        function buselAreaCoef(a) {
            if (a <= 0.25) return 2.0; // до 0.25 м²
            if (a >= 7.5) return 2.0;
            if (a >= 6.5) return 1.5;
            if (a >= 5.5) return 1.3;
            if (a >= 4.5) return 1.2;
            if (a >= 3.5) return 1.1;
            return 1.0;
        }

        // Табл.3 (Busel): коеф. від площі партії гартування
        function buselBatchCoef(a) {
            if (a >= 2.5) return 1.0;
            if (a >= 1.5) return 1.1;
            return 1.3;
        }

        // Табл.1 (Busel): тариф гартування, грн/м² (02.10.2024)
        const BUSel_TEMPER_TARIFF = {
            FLOAT: { 4: 237.20, 5: 247.32, 6: 270.67 },
            ULTRA_TONED_SATIN: { 4: 282.96, 5: 282.96, 6: 282.96 },
            TEXTURED: { 4: 315.54, 6: 315.54 }
        };

        function buselMinTemperingUah(group) {
            return (group === "FLOAT") ? 750 : 999;
        }

        function buselGroupById(id) {
            const s = String(id || "");
            if (s.startsWith("float_clear_")) return "FLOAT";
            if (s.startsWith("fluted_")) return "TEXTURED";
            return "ULTRA_TONED_SATIN";
        }

        // 1) матеріал скла (UAH)
        const material = billingArea * pricePerM2;

        // 2) полірування (UAH)
        const polish = edgeLenM * (edgePolishPerM || 0);

        // 3) термообробка
        let tempering = 0;
        let matting = 0;
        let temperTariff = 0;
        let coefArea = 1.0;
        let coefBatch = 1.0;
        let temperMin = 0;

        const batchArea = (batchAreaM2 && batchAreaM2 > 0) ? batchAreaM2 : billingArea;

        if (heat === "tempered") {
            if (supplier === "busel") {
                const group = buselGroupById(supplierGlassId);
                temperTariff = (BUSel_TEMPER_TARIFF[group] && BUSel_TEMPER_TARIFF[group][thicknessMm]) ? BUSel_TEMPER_TARIFF[group][thicknessMm] : 0;
                coefArea = buselAreaCoef(billingArea);
                coefBatch = buselBatchCoef(batchArea);
                temperMin = buselMinTemperingUah(group);

                tempering = billingArea * temperTariff * coefArea * coefBatch;
                tempering = Math.max(tempering, temperMin);
            } else if (supplier === "abstract") {
                // Abstract: гартування з прайсу (грн/м²), без коефіцієнтів
                if (thicknessMm === 4) temperTariff = 265;
                else if (thicknessMm === 5) temperTariff = 275;
                else if (thicknessMm === 6) temperTariff = 290;
                tempering = billingArea * temperTariff;
            }
        }

        // Abstract: матування полотна (як окрема послуга у прайсі)
        if (supplier === "abstract" && isSatin) {
            matting = billingArea * 120;
        }

        const supplierNet = material + polish + tempering + matting;

        // 4) MT правила ціноутворення
        const mtRetail = (supplier === "busel")
            ? (supplierNet * 0.85 * 1.30)
            : (supplierNet * 1.15); // Abstract +15%

        return {
            rawArea,
            billingArea,
            edgeLenM,
            material,
            polish,
            tempering,
            matting,
            temperTariff,
            coefArea,
            coefBatch,
            temperMin,
            mtRetail
        };
    }


    function computeBillingBars(usedLengthMm, barLenMm) {
        if (usedLengthMm <= 0) return 0;
        const ratio = usedLengthMm / barLenMm;
        const whole = Math.floor(ratio);
        const frac = ratio - whole;

        if (frac === 0) return whole;
        if (whole === 0) {
            return frac <= 0.5 ? 0.5 : 1;
        }
        return frac <= 0.5 ? whole + 0.5 : whole + 1;
    }

    function calcLaitProject(input, ref) {
        const c = ref.constantsLait;

        const shelvesOut = [];

        const profilesMap = new Map();
        const glassMap = new Map();
        const boardsMap = new Map();
        const bracketsMap = new Map();
        const connectorsMap = new Map();
        const ledsMap = new Map();
        const servicesMap = new Map();
        const powerConvertersMap = new Map();
        const powerConnectorsMap = new Map();

        let totalLedPowerW = 0;
        let totalLedLengthM = 0;
        let ledShelfCount = 0;

        function getProfile(id) {
            return ref.profilesLait.find(p => p.id === id);
        }

        function getGlass(id) {
            return ref.glassLait.find(g => g.id === id);
        }

        function getGlassBySupplier(supplier, id) {
            if (supplier === 'abstract') {
              // якщо масив abstract порожній — використовуємо копію з glassLait (плавний старт)
                       const arr = (ref.glassLaitAbstract && ref.glassLaitAbstract.length)
              ? ref.glassLaitAbstract
                   : ref.glassLait;
                 return arr.find(g => g.id === id);
                  }
            // busel або дефолт
                return ref.glassLait.find(g => g.id === id);
             }

        function getBoard(id) {
            return ref.boardLait.find(b => b.id === id);
        }

        function getBracket(id) {
            return ref.bracketsLait.find(b => b.id === id);
        }

        function getLed(id) {
            return ref.ledLait.find(l => l.id === id);
        }

        function getConnector() {
            return ref.connectorsLait[0];
        }

        function getService(id) {
            return ref.servicesLait.find(s => s.id === id);
        }

        function getConverters() {
            return ref.convertersLait || [];
        }

        function getPowerConnectorLait() {
            return ref.powerConnectorLait;
        }

        function addService(key, line) {
            const existing = servicesMap.get(key);
            if (!existing) {
                servicesMap.set(key, Object.assign({}, line));
            } else {
                existing.quantity += line.quantity;
                existing.subtotal += line.subtotal;
            }
        }

        input.shelves.forEach(shelf => {
            const {
                shelfId,
                label,
                quantity,
                lengthMm,
                depthMm,
                infillType,
                infillId,
                profileFinishId,
                ledId,
                bracketId,
                glassSupplier
            } = shelf;

            const L_infill = lengthMm - c.glassOffsetMm;
            const D_infill = depthMm - c.glassOffsetMm;
            const areaM2 = (L_infill * D_infill) / 1_000_000;
            const perimeterM = 2 * (L_infill + D_infill) / 1000;

            let infillName = '';

            // ===== Наповнення =====
            if (infillType === 'glass') {
                const supplier = (glassSupplier || 'busel').toLowerCase();

                // 1) Скло клієнта (0 грн), але фіксуємо площу/шт
                if (supplier === 'client') {
                    infillName = 'Скло клієнта';
                    const billingArea = Math.max(areaM2, 0.25);
                    const key = 'client_glass_' + (L_infill + 'x' + D_infill);

                    const existing = glassMap.get(key);
                    if (!existing) {
                        glassMap.set(key, {
                            infillId: 'CLIENT_GLASS',
                            name: 'Скло клієнта (0)',
                            thicknessMm: null,
                            areaM2: billingArea * quantity,
                            quantitySheets: quantity,
                            subtotal: 0,
                            currency: 'UAH'
                        });
                    } else {
                        existing.areaM2 += billingArea * quantity;
                        existing.quantitySheets += quantity;
                    }

                    // Робота по поклейці/монтажу скла (може бути актуально навіть при склі клієнта)
                    const srvGlass = getService('srv_install_glass_lait');
                    if (srvGlass) {
                        const srvQty = billingArea * quantity;
                        const srvSub = srvQty * srvGlass.pricePerUnit;
                        addService(srvGlass.id, {
                            serviceId: srvGlass.id,
                            name: srvGlass.name,
                            unit: srvGlass.unit,
                            quantity: srvQty,
                            subtotal: srvSub,
                            currency: srvGlass.currency
                        });
                    }
                } else {
                    // 2) Busel або Abstract
                    const gl = getGlassBySupplier(supplier, infillId);
                    infillName = gl ? gl.name : 'Скло (не знайдено)';

                    if (gl) {
                        // Мінімальна площа та коефіцієнт площі (як у Busel моделі)
                        const rawArea = areaM2;
                        const billingArea = Math.max(rawArea, 0.25);

                        function areaCoef(a) {
                            if (a >= 7.5) return 2.0;
                            if (a >= 6.5) return 1.5;
                            if (a >= 5.5) return 1.3;
                            if (a >= 4.5) return 1.2;
                            if (a >= 3.5) return 1.1;
                            return 1.0;
                        }

                        const glassHeat = shelf.glassHeat || 'tempered';
                        const isTempered = (glassHeat === 'tempered');

                        // Для Busel коеф. (areaCoef) застосовуємо лише коли гартування = ON.
                        const coef = (supplier === 'busel' && isTempered) ? areaCoef(billingArea) : 1.0;
                        const edgeLenM = (2 * (L_infill + D_infill)) / 1000;

                        // Поліровка: Abstract = 55/65 грн/м.п (прайс), Busel = як було (100 грн/м.п)
                        const edgePolishPerM = (supplier === 'abstract')
                            ? (gl.thicknessMm >= 6 ? 65 : 55)
                            : 100;

                        // Abstract extras: гартування + матування (Satin) з прайсу
                        let extraPerM2 = 0;

if (supplier === 'abstract') {
    // Abstract: базова ціна = матеріал з прайсу. Гартування додаємо тільки якщо обрано "загартоване".
    if (isTempered) {
        if (gl.thicknessMm === 4) extraPerM2 += 265;
        else if (gl.thicknessMm === 5) extraPerM2 += 275;
        else if (gl.thicknessMm === 6) extraPerM2 += 290;
    }
    // Матування полотна додаємо завжди для Satin (незалежно від гартування)
    if (gl.isSatin) extraPerM2 += 120;
}

if (supplier === 'busel' && isTempered) {
    // Busel: додаємо послугу гартування (без матеріалу та обробки), грн/м²
    // групи з прайсу:
    // 1) Float 4–10 мм → 217.68
    // 2) Надпрозоре/тоноване/оптівайт/візерункове/фарбоване/триплекс → 282.96
    // 3) Травлене/з малюнком → 303.36
    const gid = String(gl.id || '').toLowerCase();
    const isSatin = !!gl.isSatin || gid.startsWith('satin');
    const isGroup2 = gid.startsWith('extra_') || gid.includes('extra_clear') || gid.includes('dark_') || gid.includes('grey') || gid.includes('graphite') || gid.includes('bronze');

    if (isSatin) extraPerM2 += 303.36;
    else if (isGroup2) extraPerM2 += 282.96;
    else extraPerM2 += 217.68;
}

const materialNet = billingArea * (gl.pricePerM2 + extraPerM2) * coef;
const polishNet = edgeLenM * edgePolishPerM;
const supplierNet = materialNet + polishNet;

// Busel: MT модель (−15% → +30%)
// Abstract: +15% до прайсу
const ABSTRACT_MARKUP = 1.15;

const mtRetail = (supplier === 'busel')
    ? (supplierNet * 0.85 * 1.30)
    : (supplier === 'abstract' ? supplierNet * ABSTRACT_MARKUP : supplierNet);
const costPerShelf = mtRetail;
                        const subtotal = costPerShelf * quantity;

                        const key = supplier + ':' + gl.id;
                        const existing = glassMap.get(key);
                        if (!existing) {
                            glassMap.set(key, {
                                infillId: gl.id,
                                name: (supplier === 'abstract' ? ('Abstract: ' + gl.name) : gl.name),
                                thicknessMm: gl.thicknessMm,
                                isTempered: isTempered,
                                glassHeat: glassHeat,
                                areaM2: rawArea * quantity,
                                quantitySheets: quantity,
                                subtotal,
                                currency: 'UAH'
                            });
                        } else {
                            existing.areaM2 += rawArea * quantity;
                            existing.quantitySheets += quantity;
                            existing.subtotal += subtotal;
                        }

                        // Послуга поклейки скла (до 1 м²) — як і було
                        const srvGlass = getService('srv_install_glass_lait');
                        if (srvGlass) {
                            const srvQty = billingArea * quantity;
                            const srvSub = srvQty * srvGlass.pricePerUnit;
                            addService(srvGlass.id, {
                                serviceId: srvGlass.id,
                                name: srvGlass.name,
                                unit: srvGlass.unit,
                                quantity: srvQty,
                                subtotal: srvSub,
                                currency: srvGlass.currency
                            });
                        }
                    }
                }
            } else {
                // ДСП
                const bd = getBoard(infillId);
                infillName = bd ? bd.name : 'ДСП (не знайдено)';

                if (bd) {
                    const key = bd.id;
                    const subtotal = areaM2 * quantity * bd.pricePerM2;
                    const ex = boardsMap.get(key);
                    if (!ex) {
                        boardsMap.set(key, {
                            infillId: bd.id,
                            name: bd.name,
                            areaM2: areaM2 * quantity,
                            perimeterM: perimeterM * quantity,
                            quantityBoards: quantity,
                            subtotal,
                            currency: bd.currency
                        });
                    } else {
                        ex.areaM2 += areaM2 * quantity;
                        ex.perimeterM += perimeterM * quantity;
                        ex.quantityBoards += quantity;
                        ex.subtotal += subtotal;
                    }

                    const srvQuarter = getService('srv_quarter_board_lait');
                    if (srvQuarter) {
                        const qty = perimeterM * quantity;
                        const sub = qty * srvQuarter.pricePerUnit;
                        addService(srvQuarter.id, {
                            serviceId: srvQuarter.id,
                            name: srvQuarter.name,
                            unit: srvQuarter.unit,
                            quantity: qty,
                            subtotal: sub,
                            currency: srvQuarter.currency
                        });
                    }
                }
            }

            const profFront = getProfile('LA1048');
            const profSideBack = getProfile('LA1049');
            const finishFront = profFront.finishes.find(f => f.id === profileFinishId);
            const finishSB = profSideBack.finishes.find(f => f.id === profileFinishId);

            const frontLenPerShelf = lengthMm;
            const backLenPerShelf = lengthMm - 2 * 30;
            const sideLenPerShelf = depthMm;

            const totalFrontLenMm = frontLenPerShelf * quantity;
            const totalBackSideLenMm = (backLenPerShelf + 2 * sideLenPerShelf) * quantity;

            function updateProfile(profile, finish, totalLenMm) {
                const key = profile.id + '|' + finish.id;
                const barLen = profile.lengthMm;

                const barsPhysical = Math.max(1, Math.ceil(totalLenMm / barLen));
                const billingBars = computeBillingBars(totalLenMm, barLen);
                const offcutMm = barsPhysical * barLen - totalLenMm;
                const subtotal = billingBars * finish.pricePerBar;

                const ex = profilesMap.get(key);
                if (!ex) {
                    profilesMap.set(key, {
                        profileId: profile.id,
                        finishId: finish.id,
                        totalLengthMm: totalLenMm,
                        barsPhysical,
                        billingBars,
                        offcutMm,
                        subtotal,
                        currency: finish.currency
                    });
                } else {
                    ex.totalLengthMm += totalLenMm;
                    ex.barsPhysical = Math.max(1, Math.ceil(ex.totalLengthMm / barLen));
                    ex.billingBars = computeBillingBars(ex.totalLengthMm, barLen);
                    ex.offcutMm = ex.barsPhysical * barLen - ex.totalLengthMm;
                    ex.subtotal = ex.billingBars * finish.pricePerBar;
                }
            }

            updateProfile(profFront, finishFront, totalFrontLenMm);
            updateProfile(profSideBack, finishSB, totalBackSideLenMm);

            const bracket = getBracket(bracketId);
            if (bracket) {
                const bracketsPerShelf =
                    lengthMm <= bracket.minQtyPerShelfUpToMm
                        ? bracket.minQtyBelowOrEqualSpan
                        : bracket.minQtyAboveSpan;
                const totalBrackets = bracketsPerShelf * quantity;
                const key = bracket.id;
                const sub = totalBrackets * bracket.pricePerPc;
                const ex = bracketsMap.get(key);
                if (!ex) {
                    bracketsMap.set(key, {
                        bracketId: bracket.id,
                        name: bracket.name,
                        quantity: totalBrackets,
                        subtotal: sub,
                        currency: bracket.currency
                    });
                } else {
                    ex.quantity += totalBrackets;
                    ex.subtotal += sub;
                }
            }

            const connectorKit = getConnector();
            const kits = quantity;
            const pcsTotal = kits * connectorKit.pcsPerKit;
            const connKey = connectorKit.id;
            const connSub = kits * connectorKit.pricePerKit;
            const exConn = connectorsMap.get(connKey);
            if (!exConn) {
                connectorsMap.set(connKey, {
                    connectorId: connectorKit.id,
                    name: connectorKit.name,
                    kits,
                    pcsTotal,
                    subtotal: connSub,
                    currency: connectorKit.currency
                });
            } else {
                exConn.kits += kits;
                exConn.pcsTotal += pcsTotal;
                exConn.subtotal += connSub;
            }

            let ledLengthMPerShelf = 0;
            if (ledId && ledId !== 'none') {
                const led = getLed(ledId);
                if (led) {
                    let totalLengthMForGroup = 0;
                    let subtotal = 0;
                    let totalPieces = 0;

                    if (led.pricingMode === 'perMeter') {
                        const ledNetLengthMm = lengthMm - 2 * c.ledOffsetMm;
                        const lengthPerShelfM = ledNetLengthMm / 1000;
                        ledLengthMPerShelf = lengthPerShelfM * quantity;
                        totalLengthMForGroup = ledLengthMPerShelf;
                        subtotal = totalLengthMForGroup * led.pricePerM;

                        if (led.needsDriver) {
                            totalLedPowerW += totalLengthMForGroup * led.powerWPerM;
                            ledShelfCount += quantity;
                        }
                    } else if (led.pricingMode === 'perPiece') {
                        const piecesPerShelf = Math.ceil(lengthMm / led.pieceLengthMm);
                        totalPieces = piecesPerShelf * quantity;
                        totalLengthMForGroup = (totalPieces * led.pieceLengthMm) / 1000;
                        ledLengthMPerShelf = totalLengthMForGroup;
                        subtotal = totalPieces * led.pricePerPiece;
                    }

                    totalLedLengthM += totalLengthMForGroup;

                    const ledKey = led.id;
                    const exLed = ledsMap.get(ledKey);
                    if (!exLed) {
                        ledsMap.set(ledKey, {
                            ledId: led.id,
                            name: led.name,
                            totalLengthM: totalLengthMForGroup,
                            subtotal,
                            currency: led.currency,
                            totalPieces: totalPieces
                        });
                    } else {
                        exLed.totalLengthM += totalLengthMForGroup;
                        exLed.subtotal += subtotal;
                        exLed.totalPieces = (exLed.totalPieces || 0) + totalPieces;
                    }

                    const srvLed = getService('srv_install_led_lait');
                    if (srvLed) {
                        const qty = quantity;
                        const sub = qty * srvLed.pricePerUnit;
                        addService(srvLed.id, {
                            serviceId: srvLed.id,
                            name: srvLed.name,
                            unit: srvLed.unit,
                            quantity: qty,
                            subtotal: sub,
                            currency: srvLed.currency
                        });
                    }
                }
            }

            const srvCut = getService('srv_cut_profile_lait');
            const srvAssy = getService('srv_assemble_frame_lait');

            if (srvCut) {
                const qty = quantity;
                const sub = qty * srvCut.pricePerUnit;
                addService(srvCut.id, {
                    serviceId: srvCut.id,
                    name: srvCut.name,
                    unit: srvCut.unit,
                    quantity: qty,
                    subtotal: sub,
                    currency: srvCut.currency
                });
            }

            if (srvAssy) {
                const qty = quantity;
                const sub = qty * srvAssy.pricePerUnit;
                addService(srvAssy.id, {
                    serviceId: srvAssy.id,
                    name: srvAssy.name,
                    unit: srvAssy.unit,
                    quantity: qty,
                    subtotal: sub,
                    currency: srvAssy.currency
                });
            }

            shelvesOut.push({
                shelfId,
                label,
                quantity,
                lengthMm,
                depthMm,
                infillType,
                infillName,
                infillSize: {
                    lengthMm: L_infill,
                    depthMm: D_infill,
                    areaM2,
                    perimeterM
                },
                ledLengthM: ledLengthMPerShelf,
                bracketsQty: bracket ? quantity * (lengthMm <= bracket.minQtyPerShelfUpToMm
                    ? bracket.minQtyBelowOrEqualSpan
                    : bracket.minQtyAboveSpan) : 0,
                connectorsKits: kits
            });
        });

        let powerInfo = {
            totalLedPowerW,
            totalLedLengthM,
            converter: null,
            requiredWithReserveW: 0
        };

        if (totalLedPowerW > 0) {
            const convs = getConverters();
            const reserveFactor = 1.3;
            const requiredWithReserveW = totalLedPowerW * reserveFactor;

            let selectedConv = convs.find(c => c.powerW >= requiredWithReserveW);
            if (!selectedConv && convs.length > 0) {
                selectedConv = convs[convs.length - 1];
            }

            if (selectedConv) {
                powerConvertersMap.set(selectedConv.id, {
                    converterId: selectedConv.id,
                    name: selectedConv.name,
                    powerW: selectedConv.powerW,
                    requiredPowerW: totalLedPowerW,
                    requiredWithReserveW,
                    quantity: 1,
                    subtotal: selectedConv.priceUah,
                    currency: selectedConv.currency,
                    article: selectedConv.article
                });

                const pc = getPowerConnectorLait();
                if (pc) {
                    const totalConnectors = ledShelfCount;
                    powerConnectorsMap.set(pc.id, {
                        connectorId: pc.id,
                        name: pc.name,
                        quantity: totalConnectors,
                        subtotal: pc.priceUah * totalConnectors,
                        currency: pc.currency,
                        article: pc.article
                    });
                }

                powerInfo = {
                    totalLedPowerW,
                    totalLedLengthM,
                    converter: selectedConv,
                    requiredWithReserveW
                };
            }
        }

        const profiles = Array.from(profilesMap.values());
        const glass = Array.from(glassMap.values());
        const boards = Array.from(boardsMap.values());
        const brackets = Array.from(bracketsMap.values());
        const connectors = Array.from(connectorsMap.values());
        const leds = Array.from(ledsMap.values());
        const services = Array.from(servicesMap.values());
        const powerConverters = Array.from(powerConvertersMap.values());
        const powerConnectors = Array.from(powerConnectorsMap.values());

        let totalMatUAH = 0;
        let totalSrvUAH = 0;

        profiles.forEach(p => totalMatUAH += toUAH(p.subtotal, p.currency, input.eurRate));
        glass.forEach(g => totalMatUAH += toUAH(g.subtotal, g.currency, input.eurRate));
        boards.forEach(b => totalMatUAH += toUAH(b.subtotal, b.currency, input.eurRate));
        brackets.forEach(b => totalMatUAH += toUAH(b.subtotal, b.currency, input.eurRate));
        connectors.forEach(c => totalMatUAH += toUAH(c.subtotal, c.currency, input.eurRate));
        leds.forEach(l => totalMatUAH += toUAH(l.subtotal, l.currency, input.eurRate));
        powerConverters.forEach(pc => totalMatUAH += toUAH(pc.subtotal, pc.currency, input.eurRate));
        powerConnectors.forEach(pc => totalMatUAH += toUAH(pc.subtotal, pc.currency, input.eurRate));
        services.forEach(s => totalSrvUAH += toUAH(s.subtotal, s.currency, input.eurRate));

        return {
            shelves: shelvesOut,
            materials: {
                profiles,
                glass,
                boards,
                brackets,
                connectors,
                leds,
                powerConverters,
                powerConnectors
            },
            services,
            power: powerInfo,
            totals: {
                materials: totalMatUAH,
                services: totalSrvUAH,
                grandTotal: totalMatUAH + totalSrvUAH,
                currency: 'UAH'
            }
        };
    }


    function rebuildGlassOptionsBySupplier() {
        const supplier = document.getElementById('glassSupplier')?.value || 'busel';
        const glassSelect = document.getElementById('glassId');
        if (!glassSelect) return;

        // запамʼятали поточний вибір
        const current = glassSelect.value;

        // беремо масив для потрібного постачальника
        const arr = (supplier === 'abstract')
            ? (refData.glassLaitAbstract && refData.glassLaitAbstract.length ? refData.glassLaitAbstract : refData.glassLait)
            : refData.glassLait;

        // очистити select
        glassSelect.innerHTML = '';

        // зібрати опції
        arr.forEach(g => {
            const opt = document.createElement('option');
            opt.value = g.id;

            // Назва в селекті:
            // 1) Для abstract — показуємо як у прайсі (name з glassLaitAbstract)
            // 2) Для busel — як у тебе було (name з glassLait)
            opt.textContent = g.name;

            glassSelect.appendChild(opt);
        });

        // відновити вибір, якщо такий id існує в новому списку
        const has = arr.some(g => g.id === current);
        glassSelect.value = has ? current : (arr[0]?.id || '');

        // якщо у тебе є логіка show/hide/перерахунку — можна тригернути тут (опційно)
        // document.getElementById('calcBtn')?.click();
    }

    // ===== UI binding =====

    const infillTypeEl = document.getElementById('infillType');
    const glassFieldEl = document.getElementById('glassField');
    const glassSupplierFieldEl = document.getElementById('glassSupplierField');
    const glassSupplierEl = document.getElementById('glassSupplier');
    const modeEl = document.getElementById('mode');
    const copyBtn = document.getElementById('copyTelegram');

    // глобальний режим (client / manager)
    let laitMode = modeEl ? modeEl.value : 'client';

    function updateModeUI(mode) {
        laitMode = mode;

        // синхронізуємо select
        if (modeEl) {
            modeEl.value = mode;
        }

        // підсвітка кнопок режиму
        document.querySelectorAll('.lait-mode-btn').forEach(btn => {
            const btnMode = btn.dataset.mode;
            btn.classList.toggle('active', btnMode === mode);
        });

        // показ / приховування детальних результатів
        const resultsContainer = document.getElementById('resultsContainer');
        if (resultsContainer) {
            const shouldShow = mode === 'manager' && resultsContainer.classList.contains('active');
            resultsContainer.style.display = shouldShow ? 'block' : 'none';
        }
    }

    function setLaitMode(mode) {
        // якщо хочемо ввімкнути режим менеджера — питаємо пароль
        if (mode === "manager" && laitMode !== "manager") {
            const pwd = prompt("Введіть пароль доступу для режиму менеджера MT:");
            if (!pwd) {
                return;
            }
            if (pwd !== MANAGER_PASSWORD) {
                alert("Невірний пароль.");
                return;
            }
        }

        updateModeUI(mode);
    }

    function updateGlassFieldVisibility() {
        const isGlass = infillTypeEl.value === 'glass';

        glassFieldEl.style.display = isGlass ? 'flex' : 'none';
        if (glassSupplierFieldEl) {
            glassSupplierFieldEl.style.display = isGlass ? 'flex' : 'none';
        }

        // коли ввімкнули "Скло" — синхронізуємо список по постачальнику
        if (isGlass) {
            rebuildGlassOptionsBySupplier();
        }
    }

    // зміна типу наповнення
    infillTypeEl.addEventListener('change', updateGlassFieldVisibility);

    // зміна постачальника скла
    if (glassSupplierEl) {
        glassSupplierEl.addEventListener('change', rebuildGlassOptionsBySupplier);
    }

    // стартова ініціалізація
    document.addEventListener('DOMContentLoaded', () => {
        updateGlassFieldVisibility();
        rebuildGlassOptionsBySupplier();
    });


    function applyPrefillFromQuery() {
        const p = new URLSearchParams(window.location.search);

        const eur = p.get('eur');
        const len = p.get('len');
        const dep = p.get('dep');
        const qty = p.get('qty');

        if (eur) document.getElementById('eurRate').value   = eur;
        if (len) document.getElementById('lengthMm').value = len;
        if (dep) document.getElementById('depthMm').value  = dep;
        if (qty) document.getElementById('quantity').value = qty;
    }

    document.addEventListener('DOMContentLoaded', applyPrefillFromQuery);

    document.getElementById('calcBtn').addEventListener('click', function () {
        const eurRate = parseFloat(document.getElementById('eurRate').value || '0');
        const lengthMm = parseFloat(document.getElementById('lengthMm').value || '0');
        const depthMm = parseFloat(document.getElementById('depthMm').value || '0');
        const quantity = parseFloat(document.getElementById('quantity').value || '0');
        const finishId = document.getElementById('finishId').value;
        const infillRaw = document.getElementById('infillType').value;
        const glassId = document.getElementById('glassId').value;
        const glassSupplier = (document.getElementById('glassSupplier')?.value || 'busel');
        const glassHeat = (document.getElementById('glassHeat')?.value || 'tempered');
const ledId = document.getElementById('ledType').value;

        let infillType, infillId;
        if (infillRaw === 'glass') {
            infillType = 'glass';
            infillId = glassId;
        } else {
            infillType = 'board';
            infillId = 'board_18mm_generic';
        }

        const inputProject = {
            eurRate,
            shelves: [
                {
                    shelfId: 'S1',
                    label: 'Полиця ' + lengthMm + '×' + depthMm,
                    quantity,
                    lengthMm,
                    depthMm,
                    infillType,
                    infillId,
                    glassSupplier,
                    glassHeat,
                    profileFinishId: finishId,
                    ledId,
                    bracketId: 'holder_LA_B'
                }
            ]
        };

        const result = calcLaitProject(inputProject, refData);
        renderResult(result, eurRate);
    });

    function clearElement(el) {
        while (el.firstChild) el.removeChild(el.firstChild);
    }

    function renderResult(result, eurRate) {
        const container = document.getElementById('resultsContainer');
        container.classList.add('active');
        // оновити видимість колонок згідно поточного режиму
        updateModeUI(laitMode);

        const shelvesSummary = document.getElementById('shelvesSummary');
        const profilesSummary = document.getElementById('profilesSummary');
        const glassSummary = document.getElementById('glassSummary');
        const boardsSummary = document.getElementById('boardsSummary');
        const bracketsSummary = document.getElementById('bracketsSummary');
        const connectorsSummary = document.getElementById('connectorsSummary');
        const ledSummary = document.getElementById('ledSummary');
        const powerSummary = document.getElementById('powerSummary');
        const servicesSummary = document.getElementById('servicesSummary');
        const explainManagerEl = document.getElementById('explainManager');
        const telegramTextarea = document.getElementById('telegramText');

        clearElement(shelvesSummary);
        clearElement(profilesSummary);
        clearElement(glassSummary);
        clearElement(boardsSummary);
        clearElement(bracketsSummary);
        clearElement(connectorsSummary);
        clearElement(ledSummary);
        clearElement(powerSummary);
        clearElement(servicesSummary);
        clearElement(explainManagerEl);
        telegramTextarea.value = '';

        result.shelves.forEach(s => {
            const div = document.createElement('div');
            div.className = 'block';
            div.innerHTML = `
                <div class="row">
                    <span>${s.label}</span>
                    <span>× ${s.quantity} шт</span>
                </div>
                <div class="rowSmall">
                    Наповнення: ${s.infillName} (${s.infillSize.lengthMm}×${s.infillSize.depthMm} мм, ${s.infillSize.areaM2.toFixed(3)} м²)
                </div>
                <div class="rowSmall">
                    Кронштейнів: ${s.bracketsQty} шт · Конекторів рамки: ${s.connectorsKits} компл
                </div>
                ${s.ledLengthM > 0 ? `<div class="rowSmall">LED: ${s.ledLengthM.toFixed(2)} м</div>` : ''}
            `;
            shelvesSummary.appendChild(div);
        });

        if (result.materials.profiles.length === 0) {
            profilesSummary.innerHTML = '<div class="rowSmall">—</div>';
        } else {
            result.materials.profiles.forEach(p => {
                const div = document.createElement('div');
                div.className = 'rowSmall';
                div.textContent =
                    `${p.profileId}/${p.finishId}: витрачено ${p.totalLengthMm.toFixed(0)} мм, ` +
                    `фізично ${p.barsPhysical.toFixed(1)} бар (відходи ${p.offcutMm.toFixed(0)} мм), ` +
                    `до оплати ${p.billingBars.toFixed(1)} бар.`;
                profilesSummary.appendChild(div);
            });
        }

        if (result.materials.glass.length === 0) {
            glassSummary.innerHTML = '<div class="rowSmall">—</div>';
        } else {
            result.materials.glass.forEach(g => {
                const div = document.createElement('div');
                div.className = 'rowSmall';
                div.textContent =
                    `${g.name}: ${g.areaM2.toFixed(3)} м², ${g.quantitySheets} шт`;
                glassSummary.appendChild(div);
            });
        }

        if (result.materials.boards.length === 0) {
            boardsSummary.innerHTML = '<div class="rowSmall">—</div>';
        } else {
            result.materials.boards.forEach(b => {
                const div = document.createElement('div');
                div.className = 'rowSmall';
                div.textContent =
                    `${b.name}: ${b.areaM2.toFixed(3)} м², периметр ${b.perimeterM.toFixed(2)} м`;
                boardsSummary.appendChild(div);
            });
        }

        if (result.materials.brackets.length === 0) {
            bracketsSummary.innerHTML = '<div class="rowSmall">—</div>';
        } else {
            result.materials.brackets.forEach(b => {
                const div = document.createElement('div');
                div.className = 'rowSmall';
                div.textContent = `${b.name}: ${b.quantity} шт`;
                bracketsSummary.appendChild(div);
            });
        }

        if (result.materials.connectors.length === 0) {
            connectorsSummary.innerHTML = '<div class="rowSmall">—</div>';
        } else {
            result.materials.connectors.forEach(c => {
                const div = document.createElement('div');
                div.className = 'rowSmall';
                div.textContent = `${c.name}: ${c.kits} компл (${c.pcsTotal} шт)`;
                connectorsSummary.appendChild(div);
            });
        }

        if (result.materials.leds.length === 0) {
            ledSummary.innerHTML = '<div class="rowSmall">—</div>';
        } else {
            result.materials.leds.forEach(l => {
                const div = document.createElement('div');
                div.className = 'rowSmall';
                const piecesPart = l.totalPieces ? ` (${l.totalPieces} шт по 2800 мм)` : '';
                div.textContent = `${l.name}: ${l.totalLengthM.toFixed(2)} м${piecesPart}`;
                ledSummary.appendChild(div);
            });
        }

        if (
            (result.materials.powerConverters.length === 0) &&
            (result.materials.powerConnectors.length === 0)
        ) {
            powerSummary.innerHTML = '<div class="rowSmall">—</div>';
        } else {
            result.materials.powerConverters.forEach(pc => {
                const div = document.createElement('div');
                div.className = 'rowSmall';
                div.textContent =
                    `${pc.name} (${pc.article}): 1 шт, ${pc.subtotal.toFixed(2)} грн ` +
                    `(потрібно ~${pc.requiredWithReserveW.toFixed(1)} W з запасом, обрано ${pc.powerW} W).`;
                powerSummary.appendChild(div);
            });
            result.materials.powerConnectors.forEach(pc => {
                const div = document.createElement('div');
                div.className = 'rowSmall';
                div.textContent =
                    `${pc.name} (${pc.article}): ${pc.quantity} шт, ${pc.subtotal.toFixed(2)} грн`;
                powerSummary.appendChild(div);
            });
        }

        if (result.services.length === 0) {
            servicesSummary.innerHTML = '<div class="rowSmall">—</div>';
        } else {
            result.services.forEach(s => {
                const div = document.createElement('div');
                div.className = 'rowSmall';
                div.textContent =
                    `${s.name}: ${s.quantity.toFixed(2)} ${s.unit}, ${s.subtotal.toFixed(2)} ${s.currency}`;
                servicesSummary.appendChild(div);
            });
        }

        document.getElementById('materialsTotal').textContent =
            'Матеріали (UAH): ' + result.totals.materials.toFixed(2);
        document.getElementById('servicesTotal').textContent =
            'Послуги (UAH): ' + result.totals.services.toFixed(2);
        document.getElementById('grandTotal').textContent =
            'Разом (UAH): ' + result.totals.grandTotal.toFixed(2);

        let profUAH = 0, glassUAH = 0, boardsUAH = 0, brUAH = 0, connUAH = 0, ledUAH = 0;
        let powerConvUAH = 0, powerConnUAH = 0;
        let physBarsTotal = 0, billBarsTotal = 0;

        result.materials.profiles.forEach(p => {
            profUAH += toUAH(p.subtotal, p.currency, eurRate);
            physBarsTotal += p.barsPhysical;
            billBarsTotal += p.billingBars;
        });
        result.materials.glass.forEach(g => glassUAH += toUAH(g.subtotal, g.currency, eurRate));
        result.materials.boards.forEach(b => boardsUAH += toUAH(b.subtotal, b.currency, eurRate));
        result.materials.brackets.forEach(b => brUAH += toUAH(b.subtotal, b.currency, eurRate));
        result.materials.connectors.forEach(c => connUAH += toUAH(c.subtotal, c.currency, eurRate));
        result.materials.leds.forEach(l => ledUAH += toUAH(l.subtotal, l.currency, eurRate));
        result.materials.powerConverters.forEach(pc => powerConvUAH += toUAH(pc.subtotal, pc.currency, eurRate));
        result.materials.powerConnectors.forEach(pc => powerConnUAH += toUAH(pc.subtotal, pc.currency, eurRate));

        let cutUAH = 0, assyUAH = 0, quarterUAH = 0, ledSrvUAH = 0, glueUAH = 0;
        result.services.forEach(s => {
            const valUAH = toUAH(s.subtotal, s.currency, eurRate);
            if (s.serviceId === 'srv_cut_profile_lait') cutUAH += valUAH;
            else if (s.serviceId === 'srv_assemble_frame_lait') assyUAH += valUAH;
            else if (s.serviceId === 'srv_quarter_board_lait') quarterUAH += valUAH;
            else if (s.serviceId === 'srv_install_led_lait') ledSrvUAH += valUAH;
            else if (s.serviceId === 'srv_install_glass_lait') glueUAH += valUAH;
        });

        const notes = [];
        const em = explainManagerEl;
        const addLine = text => {
            notes.push(text);
            const div = document.createElement('div');
            div.className = 'rowSmall';
            div.textContent = text;
            em.appendChild(div);
        };

        if (profUAH > 0) {
            addLine(`Профілі: ${profUAH.toFixed(2)} грн (факт ${physBarsTotal.toFixed(1)} бар, до оплати ${billBarsTotal.toFixed(1)} бар).`);
        }
        if (glassUAH > 0 && result.materials.glass.length > 0) {
            const g = result.materials.glass[0];
            addLine(`Скло (Busel): ${glassUAH.toFixed(2)} грн — ${g.quantitySheets} шт ${g.name}, сумарна площа ${g.areaM2.toFixed(3)} м² (м² + поліровка, −15% +30%).`);
        }
        if (boardsUAH > 0) {
            addLine(`ДСП: ${boardsUAH.toFixed(2)} грн (без кромки, з вибіркою четверті).`);
        }
        if (brUAH > 0 || connUAH > 0 || ledUAH > 0 || powerConvUAH > 0 || powerConnUAH > 0) {
            addLine(
                `Фурнітура та живлення: кронштейни ${brUAH.toFixed(2)} грн, ` +
                `конектори рамки ${connUAH.toFixed(2)} грн, ` +
                `LED ${ledUAH.toFixed(2)} грн, ` +
                `конвертер(и) ${powerConvUAH.toFixed(2)} грн, ` +
                `конектори живлення ${powerConnUAH.toFixed(2)} грн.`
            );
        }
        if (cutUAH + assyUAH + quarterUAH + ledSrvUAH + glueUAH > 0) {
            addLine(
                `Послуги: порізка+свердління профілю ${cutUAH.toFixed(2)} грн, ` +
                `збірка полиць ${assyUAH.toFixed(2)} грн, ` +
                `вибірка четверті ${quarterUAH.toFixed(2)} грн, ` +
                `поклейка скла ${glueUAH.toFixed(2)} грн, ` +
                `монтаж LED ${ledSrvUAH.toFixed(2)} грн.`
            );
        }

        if (result.power && result.power.totalLedPowerW > 0 && result.power.converter) {
            addLine(
                `LED-живлення: сумарна довжина LED ${result.power.totalLedLengthM.toFixed(2)} м, ` +
                `потужність ${result.power.totalLedPowerW.toFixed(1)} W; потрібно ~${result.power.requiredWithReserveW.toFixed(1)} W з запасом, ` +
                `обрано ${result.power.converter.powerW} W (${result.power.converter.name}).`
            );
        }

        addLine(
            `Загалом: матеріали ${result.totals.materials.toFixed(2)} грн + послуги ${result.totals.services.toFixed(2)} грн = ${result.totals.grandTotal.toFixed(2)} грн.`
        );

        // ===== Текст для Telegram =====
        const modeLabel = laitMode === 'manager' ? 'менеджер MT' : 'клієнт';
        const shelvesLine = result.shelves
            .map(s => `${s.label} ×${s.quantity}`)
            .join('; ');

        const msgLines = [
            '📨 Нова заявка: LAIT (Lite)',
            `🔁 Режим: ${modeLabel}`,
            `Курс EUR: ${eurRate.toFixed(2)}`,
            `Полиці: ${shelvesLine}`,
            '',
            `Матеріали: ${result.totals.materials.toFixed(2)} грн`,
            `Послуги: ${result.totals.services.toFixed(2)} грн`,
            `Разом: ${result.totals.grandTotal.toFixed(2)} грн`,
            '',
            'Пояснення:',
            ...notes.map(n => '• ' + n)
        ];

        telegramTextarea.value = msgLines.join('\n');

        // короткий текст під карткою результату
        const summaryShort =
            `Полиці: ${shelvesLine}. Орієнтовна вартість комплекту ~${result.totals.grandTotal.toFixed(2)} грн.`;
        updateLaitResult(result.totals.grandTotal, eurRate, summaryShort);
    }

    if (copyBtn) {
        copyBtn.addEventListener('click', () => {
            const text = document.getElementById('telegramText').value;
            if (!text) return;
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    const old = copyBtn.textContent;
                    copyBtn.textContent = 'Скопійовано';
                    setTimeout(() => {
                        copyBtn.textContent = old;
                    }, 1500);
                });
            }
        });
    }

    // select режиму теж проходить через setLaitMode (з паролем)
    if (modeEl) {
        modeEl.addEventListener('change', (e) => {
            setLaitMode(e.target.value);
        });
    }

    // стартовий стан — клієнт, без колонок
    document.addEventListener('DOMContentLoaded', () => {
        setLaitMode(laitMode);
    });

    // === Оновлення картки результату (верхній блок) ===
    function updateLaitResult(totalUah, eurRate, summaryText) {
        const totalEur = eurRate > 0 ? totalUah / eurRate : 0;

        const uahEl = document.getElementById('lait-total-uah');
        const eurEl = document.getElementById('lait-total-eur');
        const summaryEl = document.getElementById('lait-result-summary');

        if (uahEl) uahEl.textContent = totalUah.toFixed(2);
        if (eurEl) eurEl.textContent = totalEur.toFixed(2);
        if (summaryEl && summaryText) summaryEl.textContent = summaryText;

        // === handoff back to ONLY (ЗАВЖДИ ФІНАЛЬНІ ЦИФРИ) ===
        // localStorage.setItem("ONLY_LAIT_TOTAL_EUR", totalEur.toFixed(2));
        localStorage.setItem("ET_LAIT_TOTAL_EUR", totalEur.toFixed(2));
        // localStorage.setItem("ONLY_LAIT_TOTAL_UAH", totalUah.toFixed(2));
        localStorage.setItem("ET_LAIT_TOTAL_UAH", totalUah.toFixed(2));
        // localStorage.setItem("ONLY_LAIT_META", JSON.stringify({
        //     lenMm: Number(window.lengthMm),
        //     depMm: Number(window.depthMm),
        //     qty: Number(window.quantity),
        //     ts: Date.now()
        // }));

        
        localStorage.setItem("ET_LAIT_META", localStorage.getItem("ONLY_LAIT_META"));function getSrcNamespace(){
            const p = new URLSearchParams(location.search);
            const src = (p.get("src") || "only").toLowerCase();
            if (src === "et") return "ET";
            return "ONLY";
        }

        const NS = getSrcNamespace(); // "ET" або "ONLY"

        localStorage.setItem(`${NS}_LAIT_TOTAL_EUR`, totalEur.toFixed(2));
        localStorage.setItem(`${NS}_LAIT_TOTAL_UAH`, totalUah.toFixed(2));
        localStorage.setItem(`${NS}_LAIT_META`, JSON.stringify({
            lenMm: Number(window.lengthMm),
            depMm: Number(window.depthMm),
            qty: Number(window.quantity),
            ts: Date.now()
        }));

    }



    // === Відправка в Telegram ===
    async function sendLaitToTelegram() {
        const name = document.getElementById("lait-name").value.trim();
        const phone = document.getElementById("lait-phone").value.trim();
        const email = document.getElementById("lait-email").value.trim();

        const textArea = document.getElementById("telegramText");
        const bodyText = textArea ? textArea.value.trim() : "";

        if (!name || !phone) {
            alert("Вкажіть, будь ласка, імʼя та телефон.");
            return;
        }
        if (!bodyText) {
            alert("Спочатку натисніть «Розрахувати», щоб сформувати текст заявки.");
            return;
        }

        const header = laitMode === "client"
            ? "🧮 Заявка LAIT (клієнт)\n"
            : "🧮 Заявка LAIT (для менеджера)\n";

        const contact =
            `👤 ${name}\n` +
            `📞 ${phone}\n` +
            (email ? `✉️ ${email}\n` : "") +
            `Режим: ${laitMode === "client" ? "клієнт" : "менеджер"}\n\n`;

        const text = header + contact + bodyText;

        try {
            const res = await fetch(TELEGRAM_ENDPOINT, {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({
                    secret: TELEGRAM_FORM_SECRET,
                    text: text
                })
            });

            const data = await res.json().catch(() => ({}));

            if (!res.ok || data.ok === false) {
                console.error("Telegram error", data);
                alert("Не вдалося надіслати заявку. Спробуйте ще раз або скопіюйте текст вручну.");
                return;
            }

            alert("Заявку надіслано в MT × Systems. Менеджер звʼяжеться з вами.");
        } catch (err) {
            console.error(err);
            alert("Сталася помилка під час відправки. Спробуйте ще раз або скопіюйте текст вручну.");
        }
    }

    const sendBtn = document.getElementById("lait-send-btn");
    if (sendBtn) {
        sendBtn.addEventListener("click", sendLaitToTelegram);
    }
</script>


<script>
  // smooth-scroll pills
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('[data-scroll]').forEach(btn => {
      btn.addEventListener('click', () => {
        const sel = btn.getAttribute('data-scroll');
        const el = sel ? document.querySelector(sel) : null;
        if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
      });
    });
  });
</script>

</body>
</html>